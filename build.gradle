buildscript {
    repositories {
        jcenter()
        mavenLocal()
        mavenCentral()
    }
    dependencies {
        classpath 'com.github.jengelman.gradle.plugins:shadow:1.2.3'
        classpath group: 'kr.motd.gradle', name: 'sphinx-gradle-plugin', version: '1.0.3.Final'
    }
}

plugins {
    id "net.ltgt.apt" version "0.5"
    id "de.undercouch.download" version "3.2.0"
}


apply plugin: 'java'
apply plugin: 'maven'
apply plugin: 'scala'
apply plugin: 'idea'
apply plugin: 'kr.motd.sphinx'

group = 'beam'
version = '0.2.0-SNAPSHOT'

description = """"""

sourceCompatibility = 1.8
targetCompatibility = 1.8

sourceSets.main.scala.srcDirs = ["src/main/scala", "src/main/java"]
sourceSets.main.java.srcDirs = []

repositories {
    maven { url "http://maven.geotoolkit.org/" }
    maven { url "https://repository.jboss.org/nexus/content/repositories/thirdparty-releases" }
    maven { url "http://central.maven.org/maven2"}
    maven { url "http://repo.maven.apache.org/maven2" }
    maven { url "http://download.osgeo.org/webdav/geotools" }
    maven { url "http://dl.bintray.com/matsim/matsim" }
    maven { url "http://maven.conveyal.com/" }
    maven { url "http://nexus.onebusaway.org/content/groups/public/" }
    maven { url "http://repo1.maven.org/maven2" }
    maven { url "http://download.java.net/maven/2/" }
    maven { url "http://people.apache.org/repo/m1-ibiblio-rsync-repository/org.apache.axis2/" }
    maven { url "http://dl.bintray.com/andimarek/graphql-java" }
    maven { url "http://maven.geo-solutions.it" }
    maven {url "http://dl.bintray.com/scalaz/releases"}

    jcenter()
    maven { url "https://jitpack.io" }
}

dependencies {

    ////////////////////////////
    // Java dependencies
    ////////////////////////////

    compile group: 'jdom', name: 'jdom', version:'1.1'
    compile group: 'com.google.inject', name: 'guice', version:'4.1.0'
	compile group: 'com.google.inject.extensions', name: 'guice-assistedinject', version: '4.1.0'
    compile group: 'com.google.inject.extensions', name: 'guice-multibindings', version:'4.1.0'
    compile group: 'com.google.guava', name: 'guava', version:'19.0'
    compile group: 'de.ruedigermoeller', name: 'fst', version:'2.47'
    compile group: 'org.jfree', name: 'jfreechart', version:'1.0.14'
    compile group: 'org.apache.commons', name: 'commons-math3', version:'3.5'
    compile group: 'org.geotools', name: 'gt-main', version:'13.0'
    compile group: 'org.geotools', name: 'gt-referencing', version:'13.0'
    compile group: 'org.geotools', name: 'gt-shapefile', version:'13.0'
    compile group: 'net.sf.trove4j', name: 'trove4j', version:'3.0.3'
    runtime group: 'org.geotools', name: 'gt-epsg-hsql', version:'13.0'
    // https://mvnrepository.com/artifact/aopalliance/aopalliance
    compile group: 'aopalliance', name: 'aopalliance', version: '1.0'
    // https://mvnrepository.com/artifact/de.ruedigermoeller/fst
    compile group: 'de.ruedigermoeller', name: 'fst', version: '2.48'
    // https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-core
    compile group: 'com.fasterxml.jackson.core', name: 'jackson-core', version: '2.5.5'
    // https://mvnrepository.com/artifact/org.javassist/javassist
    compile group: 'org.javassist', name: 'javassist', version: '3.19.0-GA'
    // https://mvnrepository.com/artifact/javax.inject/javax.inject
    compile group: 'javax.inject', name: 'javax.inject', version: '1'
    // https://mvnrepository.com/artifact/jdom/jdom
    compile group: 'jdom', name: 'jdom', version: '1.1'
    // https://mvnrepository.com/artifact/log4j/log4j
    compile group: 'log4j', name: 'log4j', version: '1.2.16'
    // https://mvnrepository.com/artifact/org.matsim.contrib/multimodal
    compile group: 'org.matsim.contrib', name: 'multimodal', version: '0.8.0'
    // https://mvnrepository.com/artifact/org.objenesis/objenesis
    compile group: 'org.objenesis', name: 'objenesis', version: '2.4'
    // https://mvnrepository.com/artifact/javax.jms/jms
    compile group: 'javax.jms', name: 'jms', version: '1.1'
    // https://mvnrepository.com/artifact/javax.media/jai_core
    compile group: 'javax.media', name: 'jai_core', version: '1.1.3'
    // https://mvnrepository.com/artifact/junit/junit
    testCompile group: 'junit', name: 'junit', version: '4.4'
    // https://mvnrepository.com/artifact/org.geotools/gt-referencing
    compile group: 'org.geotools', name: 'gt-referencing', version: '15.2'
    // https://mvnrepository.com/artifact/org.geotools/gt-epsg-hsql
    compile group: 'org.geotools', name: 'gt-epsg-hsql', version: '15.2'
    // https://mvnrepository.com/artifact/commons-io/commons-io
	compile group: 'commons-io', name: 'commons-io', version: '2.5'
	compile group: 'com.esotericsoftware', name: 'kryo-shaded', version: '4.0.0'
    compile group: 'edu.ucar', name: 'udunits', version: '4.5.5'
    compile 'com.github.shevek:graphviz4j:master-SNAPSHOT'
    compile 'org.reflections:reflections:0.9.10'
    compile group: 'javax.annotation', name: 'javax.annotation-api', version: '1.2-b01'
    compile 'com.github.colinsheppard.matsim_all:matsim:master-SNAPSHOT'
    compile 'com.github.colinsheppard:OpenTripPlanner:otp-1.0.0-beam-SNAPSHOT'


    /////////////////////////////////
    // Scala dependencies
    /////////////////////////////////

    // CORE Scala //
    compile 'org.scala-lang:scala-library:2.12.0'
    // https://mvnrepository.com/artifact/org.scala-lang/scala-xml
    compile group: 'org.scala-lang', name: 'scala-xml', version: '2.11.0-M4'
    // https://mvnrepository.com/artifact/org.scalatest/scalatest_2.11

    // TEST Scala //
    testCompile group: 'org.scalatest', name: 'scalatest_2.12', version: '3.0.1'


    // 3rd Party Scala //
    //    compile 'org.scalaz:scalaz-core_2.12:7.3.0-M9'
    compile 'net.codingwell:scala-guice_2.12:4.1.0'  // DI
    compile 'com.github.carueda:tscfg:v0.8.0'  // config


    /////////////
    // Akka Dependencies
    ////////////

    // CORE Akka //
    compile group: 'com.typesafe.akka', name: 'akka-actor_2.12', version: '2.4.16'
    compile group: 'com.typesafe.akka', name: 'akka-persistence_2.12', version: '2.4.16'
    compile group: 'com.typesafe.akka', name: 'akka-remote_2.12', version: '2.4.16'
    compile group: 'com.typesafe.akka', name: 'akka-cluster_2.12', version: '2.4.16'
    compile group: 'com.typesafe.akka', name: 'akka-contrib_2.12', version: '2.4.16'
    compile group: 'org.iq80.leveldb', name: 'leveldb', version: '0.9'

    // TEST Akka //
    testCompile group: 'com.typesafe.akka', name: 'akka-testkit_2.12', version: '2.4.16'

    // 3rd Party Akka //
    //compile group: 'org.iq80.leveldb', name: 'leveldb', version: '0.7'
    compile group: 'org.fusesource.leveldbjni', name: 'leveldbjni-all', version: '1.8'
    //compile group: 'com.google.protobuf', name: 'protobuf-java', version: '2.5.0'
    compile 'tv.cntt:glokka_2.12:2.4.0'  // Actor registry


}


// Task to run scala tests, as Scala tests not picked up by Gradle by default.
task spec(dependsOn: ['testClasses'], type: JavaExec) {
    main = 'org.scalatest.tools.Runner'
    args = ['-R', 'build/classes/test', '-o']
    classpath = sourceSets.test.runtimeClasspath
}

//////////////////////////////////////////////////////////////////////
// BUNDLING FOR EXECUTION
//
// Shadowjar bundles model together into executable jar
//////////////////////////////////////////////////////////////////////


apply plugin: 'com.github.johnrengelman.shadow'

jar {
   manifest {
       attributes 'Main-Class': 'beam.EVSimTeleController'
   }
}

shadowJar {
   baseName = 'beam'
   classifier = null
   version = null
}

//////////////////////////////////////////////////////////////////////
// Generate config classes reflecting the application.conf file
//////////////////////////////////////////////////////////////////////
task generateConfig {
  doLast {
    if(!project.file('build/tscfg-0.8.0.jar').exists()){
      download {
	  src 'https://github.com/carueda/tscfg/releases/download/v0.8.0/tscfg-0.8.0.jar'
	  dest buildDir
      }
    }
    javaexec { 
      main="-jar";
      args = [
	      "build/tscfg-0.8.0.jar",
	      "--spec","src/main/resources/config-template.conf",
	      "--scala",
	      "--pn","beam.agentsim.config",
	      "--cn","BeamConfig",
	      "--dd","src/main/scala/beam/agentsim/config/"
	     ]
    } 
  }
}
