apply plugin: 'java'
apply plugin: 'maven'
apply plugin: 'idea'

group = 'beam'
version = '0.1.0-SNAPSHOT'

description = """"""

sourceCompatibility = 1.8
targetCompatibility = 1.8

repositories {
    maven { url "http://maven.geotoolkit.org/" }
    maven { url "https://repository.jboss.org/nexus/content/repositories/thirdparty-releases" }
    maven { url "http://central.maven.org/maven2" }
    maven { url "http://repo.maven.apache.org/maven2" }
    maven { url "http://repo1.maven.org/maven2" }
    maven { url "http://download.osgeo.org/webdav/geotools" }
    maven { url "http://dl.bintray.com/matsim/matsim" }
    maven { url "https://maven.conveyal.com/" }
    maven { url "http://download.java.net/maven/2/" }
    maven { url "http://people.apache.org/repo/m1-ibiblio-rsync-repository/org.apache.axis2/" }
    maven { url "http://dl.bintray.com/andimarek/graphql-java" }
    maven { url "http://maven.geo-solutions.it" }
    maven { url "http://dl.bintray.com/scalaz/releases" }
    mavenLocal()
    mavenCentral()
    jcenter()
    maven { url "http://nexus.onebusaway.org/content/groups/public/" }
    maven { url "https://jitpack.io" }
}

dependencies {
    compile group: 'org.apache.commons', name: 'commons-math3', version:'3.5'
    compile group: 'org.geotools', name: 'gt-epsg-wkt', version: '16.0'
    compile group: 'org.geotools', name: 'gt-shapefile', version:'16.0'
    compile group: 'junit', name: 'junit', version: '4.6'
    compile group: 'commons-io', name: 'commons-io', version: '2.5'
    compile group: 'com.esotericsoftware', name: 'kryo-shaded', version: '4.0.0'
    compile 'com.github.colinsheppard.matsim_all:matsim:master-SNAPSHOT'
    compile group: 'org.matsim.contrib', name: 'multimodal', version: '0.8.0'
    compile group: 'jgridshift', name: 'jgridshift', version: '1.0'
    //compile group: 'com.google.guava', name: 'guava', version: '21.0'
    //compile group: 'com.datastax.cassandra', name: 'cassandra-driver-core', version: '3.1.4'
    compile group: 'org.postgresql', name: 'postgresql', version: '9.4.1212'
//    compile group: 'org.mapdb', name: 'mapdb', version: '3.0.4'
//    compile group: 'org.mapdb', name: 'mapdb', version: '1.0.8'
    compile group: 'com.github.LBNL-UCB-STI', name: 'mapdb', version: 'release-3.0-SNAPSHOT', changing: false
    runtime files('/Users/critter/.gradle/caches/modules-2/files-2.1/com.conveyal/jackson2-geojson/0.8/4419e90e57b8eaa1a0065a8341f53553c37193ee/jackson2-geojson-0.8.jar')
//    compile group: 'com.conveyal', name: 'r5', version: '2.1.1'
    compile group: 'com.github.LBNL-UCB-STI', name: 'r5', version: 'beam-calibration-SNAPSHOT', changing: true
}

//////////////////////////////////////////////////////////////////////
// BUNDLING FOR EXECUTION
//
// Shadowjar bundles model together into executable jar
//////////////////////////////////////////////////////////////////////

buildscript {
    repositories {
        jcenter()
        mavenLocal()
        mavenCentral()
    }
    dependencies {
        classpath 'com.github.jengelman.gradle.plugins:shadow:1.2.3'
    }
}

apply plugin: 'com.github.johnrengelman.shadow'

jar {
   manifest {
       attributes 'Main-Class': 'beam.EVSimTeleController'
   }
}

shadowJar {
   baseName = 'beam'
   classifier = null
   version = null
}

task runBeam() {
    doLast {
        javaexec {
            classpath = sourceSets.main.runtimeClasspath

            main = 'beam.EVSimTeleController'

            args = [project.hasProperty('absPathToInputs') ? project.getProperty('absPathToInputs') : '',
                    project.hasProperty('relPathToConfig') ? project.getProperty('relPathToConfig') : '',
                    project.hasProperty('absPathToOutputs') ? project.getProperty('absPathToOutputs') : '']

            jvmArgs = [project.hasProperty('jvmArgs') ? project.getProperty('jvmArgs') : '']
        }
    }
}

